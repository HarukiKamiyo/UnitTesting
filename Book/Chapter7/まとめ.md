### 1\. テスト対象を選定するための2つの指標

まず、どのコードをテストすべきかを判断するために、以下の2つの基準が定義されています。

  * **コードの複雑さ:**
      * コード内で「決定を下す箇所（分岐）」の数で判断されます。
  * **ドメインにおける重要性:**
      * そのコードがビジネス上の課題解決において、どれだけ重要かを示します。複雑なコードは重要度が高い傾向にあります。

### 2\. 単体テストの「価値」と「コスト」

テストの費用対効果（ROI）は以下のように決まります。

  * **価値が高いテスト:** 「複雑で、かつ重要なコード」に対するテスト。バグが発生した際のダメージが大きいため、退行（リグレッション）を防ぐ保護機能として高い価値を持ちます。
  * **コストが高いテスト:** 「協力者オブジェクト（依存先）が多いコード」に対するテスト。モックの準備や状態管理が大変で、維持費（保守コスト）が高くなります。

### 3\. コードの4分類とテスト戦略

上記の指標に基づき、すべてのコードは4つのタイプに分類できます。本章のまとめでは、リファクタリング後の理想的な3つの状態について、推奨されるテスト方針が示されています。

| コードの分類 | 特徴（複雑さ・重要性 / 依存数） | 推奨されるテスト方針 | 理由 |
| :--- | :--- | :--- | :--- |
| **ドメイン・モデル<br>(アルゴリズム)** | **高い** / 少ない | **単体テスト**<br>(最優先) | 費用対効果が最も高い。ロジックが複雑だが依存が少ないため、低コストで手厚い保護が得られる。 |
| **コントローラ** | 低い / **多い** | **統合テスト** | ロジックは単純だが依存が多いため、単体テストはコスト高になる。結合部分を確認する統合テストが適している。 |
| **取るに足らないコード** | 低い / 少ない | **テストしない** | テストを書く価値も、維持する価値もない。 |

> **補足:** ここに記載されていない4つ目の分類（**過度に複雑なコード**：複雑かつ依存も多い）は、本章で取り組んできた「避けるべき状態」です。これを「ドメイン・モデル」と「コントローラ」に分離することが、本章のリファクタリングの目的でした。

### 結論

**「ビジネス・ロジック（ドメイン・モデル）は単体テストで守り、コントローラは統合テストで守る」** という役割分担を明確にすることで、テストの保守コストを抑えつつ、プロジェクトの品質を最大限に高めることができます。